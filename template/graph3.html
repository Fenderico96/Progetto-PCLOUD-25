<!DOCTYPE HTML>
<html>
    <head>
        <title>Graph</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/main.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style> /*codice chiesto a gemini per migliorare la grafica degli sliders sul sito*/
            body {
                font-family: Arial, sans-serif;
                margin: 30px;
            }

            #sliderContainer, #datePickerContainer { /* Aggiungi #datePickerContainer qui */
                margin: 20px 0;
                display: flex; /* Use flexbox for horizontal alignment */
                justify-content: center; /* Center the items horizontally */
                align-items: center;
                gap: 20px; /* Space between items */
                flex-wrap: wrap;
                background-color: rgba(255, 255, 255, 0.08); /* Slightly more opaque for better visibility, adjust as needed */
                padding: 15px 25px; /* Increased padding */
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Subtle shadow for depth */
                color: white; /* Ensure text is visible against the background */
            }

            #sliderContainer label, #datePickerContainer label { /* Applica lo stile anche alla label del date picker */
                font-weight: bold;
                white-space: nowrap; /* Prevent labels from wrapping */
            }

            #sliderContainer input[type="range"] {
                flex-grow: 1; /* Allow sliders to take up available space */
                max-width: 300px; /* Limit slider width for better control */
                -webkit-appearance: none; /* Remove default slider styles for custom styling */
                appearance: none;
                height: 8px; /* Thinner track */
                background: rgba(255, 255, 255, 0.3); /* Lighter track color */
                outline: none;
                border-radius: 5px;
                transition: opacity .2s;
            }

            #sliderContainer input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px; /* Larger thumb */
                height: 20px; /* Larger thumb */
                background: #007bff; /* Blue thumb color, adjust to match your theme */
                cursor: pointer;
                border-radius: 50%; /* Circular thumb */
                border: 2px solid white; /* White border for contrast */
            }

            #sliderContainer input[type="range"]::-moz-range-thumb {
                width: 20px;
                height: 20px;
                background: #007bff;
                cursor: pointer;
                border-radius: 50%;
                border: 2px solid white;
            }

            #sliderContainer span {
                min-width: 60px; /* Ensure time labels have consistent width */
                text-align: right;
            }

            #datePickerContainer input[type="date"] { /* Stile per l'input data */
                padding: 8px;
                border-radius: 5px;
                border: 1px solid rgba(255, 255, 255, 0.3);
                background-color: rgba(255, 255, 255, 0.15); /* Sfondo leggermente trasparente */
                color: white; /* Testo bianco */
                font-size: 1em;
            }
            /* Per cambiare il colore dell'icona del calendario e del testo nel date input */
            #datePickerContainer input[type="date"]::-webkit-calendar-picker-indicator {
                filter: invert(1); /* Inverte i colori dell'icona per farla diventare bianca */
            }
        </style>
    </head>
    <body class="is-preload">

        <header id="header">
                <a href="index.html" class="title">Hyperspace</a>
                <nav>
                    <ul>
                        <li><a href="hub.html">Home</a></li>
                        <li><a href="graph.html" class="active">Graph</a></li>
                        <li><a href="alarm.html">Alarm</a></li>
                        <li><a href="hub.html#three">Logout</a></li>
                    </ul>
                </nav>
            </header>

        <div id="wrapper">

                <section id="main" class="wrapper">
                        <div class="inner">
                            <h1 class="major">Graph</h1>
                            <div id="datePickerContainer">
                                <label for="datePicker">Select Date:</label>
                                <input type="date" id="datePicker">
                            </div>
                            <canvas id="temperatureChart" height="100"></canvas>
                            <div id="sliderContainer">
                                <label for="startTime">From:</label>
                                <input type="range" id="startTime" min="0" max="23" value="0" />
                                <span id="startLabel">00:00</span>

                                <label for="endTime" style="margin-left: 20px;">To:</label>
                                <input type="range" id="endTime" min="0" max="23" value="23" />
                                <span id="endLabel">23:00</span>
                            </div>
                        </div>
                    </section>

            </div>

        <footer id="footer" class="wrapper alt">
                <div class="inner">
                    <ul class="menu">
                        <li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                    </ul>
                </div>
            </footer>

            <script>
                // --- Dati Fittizi Aggiornati con Data ---
                // Simulo dati per 3 giorni: 12, 13, 14 luglio 2025
                const historicalTemperatureData = [];
                const historicalProblemData = [];

                // Genera dati per 3 giorni
                for (let d = 12; d <= 14; d++) {
                    for (let i = 0; i < 24; i++) {
                        const dateStr = `2025-07-${d.toString().padStart(2, '0')}`;
                        historicalTemperatureData.push({
                            date: dateStr,
                            time: `${i.toString().padStart(2, '0')}:00`,
                            temp: 20 + Math.sin(i / 3) * 5 + Math.random() * 2 // Valori simulati
                        });
                    }
                }

                // Genera problemi fittizi per gli stessi giorni
                historicalProblemData.push(
                    { date: '2025-07-12', time: '03:00', temp: 26.5, description: 'High Temp Alert (Day 1)' },
                    { date: '2025-07-12', time: '08:00', temp: 19.2, description: 'Low Temp Warning (Day 1)' },
                    { date: '2025-07-13', time: '15:00', temp: 28.0, description: 'Sensor Malfunction (Day 2)' },
                    { date: '2025-07-13', time: '20:00', temp: 27.1, description: 'High Temp Alert (Day 2)' },
                    { date: '2025-07-14', time: '05:00', temp: 18.0, description: 'Equipment Failure (Day 3)' }
                );

                // --- FINE Dati Fittizi Aggiornati ---


                // --- NUOVE LINEE PER IL PADDING DEGLI ASSI (rimane uguale) ---
                // Questi verranno ricalcolati in updateChart per i dati filtrati
                const allTemperatures = [
                    ...historicalTemperatureData.map(d => d.temp),
                    ...historicalProblemData.map(d => d.temp)
                ];

                const minTemp = Math.min(...allTemperatures);
                const maxTemp = Math.max(...allTemperatures);

                const padding = 2; // Margine di 2 gradi sopra e sotto
                const suggestedMinY = minTemp - padding;
                const suggestedMaxY = maxTemp + padding;
                // --- FINE NUOVE LINEE ---


                const ctx = document.getElementById('temperatureChart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [], // Inizialmente vuoto, sarà popolato da updateChart
                        datasets: [
                            {
                                label: 'Temperature (°C)',
                                data: [], // Inizialmente vuoto
                                borderColor: 'white',
                                tension: 0.4,
                                fill: false
                            },
                            {
                                type: 'scatter',
                                label: 'Problems',
                                data: [], // Inizialmente vuoto
                                backgroundColor: 'red',
                                borderColor: 'red',
                                pointRadius: 8,
                                pointHoverRadius: 10,
                                showLine: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Temperature (°C)'
                                },
                                min: suggestedMinY, // Questi saranno sovrascritti da updateChart
                                max: suggestedMaxY  // Questi saranno sovrascritti da updateChart
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time'
                                },
                                type: 'category'
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.dataset.type === 'scatter') {
                                            // Accedi direttamente alla descrizione dal punto dati
                                            label += `${context.raw.description || 'Nessuna descrizione'} (${context.parsed.y}°C)`;
                                        } else {
                                            label += `${context.parsed.y}°C`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                // Elementi del DOM
                const datePicker = document.getElementById('datePicker');
                const startSlider = document.getElementById('startTime');
                const endSlider = document.getElementById('endTime');
                const startLabel = document.getElementById('startLabel');
                const endLabel = document.getElementById('endLabel');

                // Imposta la data predefinita al giorno corrente (o all'ultimo giorno disponibile nei dati fittizi)
                const today = new Date();
                const year = today.getFullYear();
                const month = (today.getMonth() + 1).toString().padStart(2, '0');
                const day = today.getDate().toString().padStart(2, '0');
                const defaultDate = `2025-07-12`; // Puoi impostarlo a oggi: `${year}-${month}-${day}`;

                datePicker.value = defaultDate; // Imposta il valore predefinito del date picker

                function updateChart() {
                    const selectedDate = datePicker.value;
                    let start = parseInt(startSlider.value);
                    let end = parseInt(endSlider.value);

                    if (start > end) [start, end] = [end, start];

                    // Filtra i dati per la data e l'ora selezionate
                    const filteredTemperature = historicalTemperatureData.filter(d => {
                        const dataHour = parseInt(d.time.split(':')[0]);
                        return d.date === selectedDate && dataHour >= start && dataHour <= end;
                    });

                    const filteredProblems = historicalProblemData.filter(p => {
                        const problemHour = parseInt(p.time.split(':')[0]);
                        return p.date === selectedDate && problemHour >= start && problemHour <= end;
                    });

                    chart.data.labels = filteredTemperature.map(d => d.time);
                    chart.data.datasets[0].data = filteredTemperature.map(d => d.temp);
                    chart.data.datasets[1].data = filteredProblems.map(d => ({ x: d.time, y: d.temp, description: d.description }));

                    // --- Ricalcola min/max per il padding solo per i dati filtrati ---
                    const currentAllTemperatures = [
                        ...filteredTemperature.map(d => d.temp),
                        ...filteredProblems.map(d => d.temp)
                    ];

                    // Se non ci sono dati nel range filtrato, imposta un range predefinito
                    if (currentAllTemperatures.length > 0) {
                        const currentMinTemp = Math.min(...currentAllTemperatures);
                        const currentMaxTemp = Math.max(...currentAllTemperatures);
                        chart.options.scales.y.min = currentMinTemp - padding;
                        chart.options.scales.y.max = currentMaxTemp + padding;
                    } else {
                        // Nessun dato, imposta un range di default o nascondi il grafico
                        chart.options.scales.y.min = 0;
                        chart.options.scales.y.max = 30;
                    }
                    // --- FINE RICALCOLO ---

                    chart.update();

                    startLabel.textContent = `${start.toString().padStart(2, '0')}:00`;
                    endLabel.textContent = `${end.toString().padStart(2, '0')}:00`;
                }

                // Event Listeners per i cambiamenti
                datePicker.addEventListener('change', updateChart); // Ascolta il cambio di data
                startSlider.addEventListener('input', updateChart);
                endSlider.addEventListener('input', updateChart);

                updateChart(); // Inizializzazione del grafico
            </script>
            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/jquery.scrollex.min.js"></script>
            <script src="assets/js/jquery.scrolly.min.js"></script>
            <script src="assets/js/browser.min.js"></script>
            <script src="assets/js/breakpoints.min.js"></script>
            <script src="assets/js/util.js"></script>
            <script src="assets/js/main.js"></script>

    </body>
</html>